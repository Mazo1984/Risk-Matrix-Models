<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Risk Model Visualization</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src='https://cdn.plot.ly/plotly-latest.min.js'></script>
    <style>
        /* Use Inter font */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Style sliders for better appearance */
        input[type=range] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
            border-radius: 4px; /* Rounded track */
        }

        input[type=range]:hover {
            opacity: 1;
        }

        /* Slider thumb styling for Webkit browsers (Chrome, Safari) */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #3b82f6; /* Blue color */
            cursor: pointer;
            border-radius: 50%; /* Circular thumb */
        }

        /* Slider thumb styling for Firefox */
        input[type=range]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #3b82f6; /* Blue color */
            cursor: pointer;
            border-radius: 50%; /* Circular thumb */
            border: none; /* Remove default border */
        }

        /* Ensure plots take up reasonable space */
        .plot-container {
            height: 450px; /* Adjust height as needed */
            width: 100%;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 p-8">

    <div class="max-w-7xl mx-auto bg-white p-6 rounded-lg shadow-md">
        <h1 class="text-2xl font-bold mb-4 text-center text-gray-800">Interactive Risk Model Visualization</h1>
        <p class="mb-6 text-center text-gray-600">
            Explore how different mathematical formulas for combining Probability (P) and Consequence (C) implicitly add risk tolerance or aversion. Adjust the sliders to see the Risk Factor (RF) calculated by each model and where your point lies on the contour plots.
        </p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <div>
                <label for="probability" class="block text-sm font-medium text-gray-700">Probability (P): <span id="pValueLabel" class="font-semibold">0.50</span></label>
                <input type="range" id="probability" min="0" max="1" step="0.01" value="0.5" class="mt-1 w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
            </div>
            <div>
                <label for="consequence" class="block text-sm font-medium text-gray-700">Consequence (C): <span id="cValueLabel" class="font-semibold">0.50</span></label>
                <input type="range" id="consequence" min="0" max="1" step="0.01" value="0.5" class="mt-1 w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 text-center">
            <div class="p-4 bg-blue-50 rounded-lg shadow-sm border border-blue-200">
                <h3 class="text-lg font-semibold text-blue-800">Model 1: RF = P * C</h3>
                <p class="text-gray-700 text-sm mb-2">(Concave Contours - Risk Tolerant)</p>
                <p class="text-2xl font-bold text-blue-600" id="rf1Value">RF = 0.25</p>
            </div>
            <div class="p-4 bg-green-50 rounded-lg shadow-sm border border-green-200">
                <h3 class="text-lg font-semibold text-green-800">Model 2: RF = 1 - (1-P)*(1-C)</h3>
                 <p class="text-gray-700 text-sm mb-2">(Convex Contours - Risk Averse)</p>
                <p class="text-2xl font-bold text-green-600" id="rf2Value">RF = 0.75</p>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div id="plot1" class="plot-container rounded-lg shadow border border-gray-200 overflow-hidden"></div>
            <div id="plot2" class="plot-container rounded-lg shadow border border-gray-200 overflow-hidden"></div>
        </div>

         <div class="mt-8 p-4 border border-gray-200 rounded-lg bg-gray-50">
             <h2 class="text-xl font-semibold mb-3 text-gray-800">Understanding the Plots</h2>
             <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-700">
                 <div>
                     <h3 class="font-medium text-blue-700">Plot 1 (RF = P * C): Risk Tolerance</h3>
                     <p>The concave curves (bulging outwards) mean that to keep the same risk level, a large increase in consequence can be offset by only a moderate decrease in probability (and vice-versa). This model is mathematically more "tolerant" of higher values in one dimension if the other is lower.</p>
                 </div>
                 <div>
                     <h3 class="font-medium text-green-700">Plot 2 (RF = 1 - (1-P)*(1-C)): Risk Aversion</h3>
                     <p>The convex curves (bulging inwards) mean that even a small increase in consequence requires a large decrease in probability to keep the same risk level (and vice-versa). This model is mathematically more sensitive to increases in either dimension, reflecting "aversion" to higher probability or consequence values.</p>
                 </div>
             </div>
         </div>

    </div>

    <script>
        // Get references to HTML elements
        const probabilitySlider = document.getElementById('probability');
        const consequenceSlider = document.getElementById('consequence');
        const pValueLabel = document.getElementById('pValueLabel');
        const cValueLabel = document.getElementById('cValueLabel');
        const rf1ValueDisplay = document.getElementById('rf1Value');
        const rf2ValueDisplay = document.getElementById('rf2Value');
        const plot1Div = document.getElementById('plot1');
        const plot2Div = document.getElementById('plot2');

        // --- Plotting Configuration ---
        const N_POINTS = 50; // Resolution for contour plots
        const C_values = Array.from({ length: N_POINTS }, (_, i) => i / (N_POINTS - 1));
        const P_values = Array.from({ length: N_POINTS }, (_, i) => i / (N_POINTS - 1));

        // --- Calculate Z values (Risk Factors) for the contour plots ---
        const z1 = []; // For RF = P * C
        const z2 = []; // For RF = 1 - (1-P)*(1-C)

        for (let i = 0; i < N_POINTS; i++) {
            const p = P_values[i];
            const row1 = [];
            const row2 = [];
            for (let j = 0; j < N_POINTS; j++) {
                const c = C_values[j];
                // Model 1: RF = P * C
                row1.push(p * c);
                // Model 2: RF = 1 - (1-P)*(1-C)
                row2.push(1 - (1 - p) * (1 - c));
            }
            z1.push(row1);
            z2.push(row2);
        }

        // --- Plotly Data and Layout ---
        const contourLayoutBase = {
            xaxis: { title: 'Consequence (C)', range: [0, 1], zeroline: false, gridcolor: '#eee' },
            yaxis: { title: 'Probability (P)', range: [0, 1], zeroline: false, gridcolor: '#eee' },
            autosize: true, // Make plot responsive
            margin: { l: 50, r: 20, b: 50, t: 50 }, // Adjust margins
            hovermode: 'closest' // Show hover info for nearest point
        };

        const contourTraceBase = {
            x: C_values,
            y: P_values,
            type: 'contour',
            contours: {
                coloring: 'lines', // Use lines instead of fill
                showlabels: true, // Show labels on contour lines
                labelfont: { size: 10, color: 'black' },
            },
            line: { width: 1.5 }, // Thinner contour lines
            connectgaps: true, // Connect gaps in contours
            hoverinfo: 'skip' // Don't show hover for contour lines themselves
        };

         // Data for the marker showing the selected point
         const markerTrace = {
            x: [0.5], // Initial C
            y: [0.5], // Initial P
            mode: 'markers',
            type: 'scatter',
            marker: {
                color: 'red',
                size: 12,
                symbol: 'x', // Use 'x' marker
                line: { width: 2, color: 'darkred'}
            },
            hoverinfo: 'text', // Custom hover text
            hovertext: '' // Will be updated dynamically
         };

        // --- Create Initial Plots ---
        Plotly.newPlot(plot1Div, [{ ...contourTraceBase, z: z1, name: 'RF = P*C', line: { color: 'blue' } }, markerTrace],
            { ...contourLayoutBase, title: 'Model 1: RF = P * C (Risk Tolerant)' } , {responsive: true}); // Add responsive config

        Plotly.newPlot(plot2Div, [{ ...contourTraceBase, z: z2, name: 'RF = 1-(1-P)(1-C)', line: { color: 'green' } }, markerTrace],
            { ...contourLayoutBase, title: 'Model 2: RF = 1-(1-P)(1-C) (Risk Averse)' }, {responsive: true}); // Add responsive config

        // --- Update Function ---
        function updateVisualization() {
            const p = parseFloat(probabilitySlider.value);
            const c = parseFloat(consequenceSlider.value);

            // Update labels
            pValueLabel.textContent = p.toFixed(2);
            cValueLabel.textContent = c.toFixed(2);

            // Calculate Risk Factors
            const rf1 = p * c;
            const rf2 = 1 - (1 - p) * (1 - c);

            // Update RF displays
            rf1ValueDisplay.textContent = `RF = ${rf1.toFixed(3)}`;
            rf2ValueDisplay.textContent = `RF = ${rf2.toFixed(3)}`;

            // Update marker position and hover text on both plots
            const hoverText = `P=${p.toFixed(2)}, C=${c.toFixed(2)}<br>RF1=${rf1.toFixed(3)}<br>RF2=${rf2.toFixed(3)}`;
            const updateData = { x: [[c]], y: [[p]], hovertext: [[hoverText]] }; // Note the double brackets for updating single point

            // Update only the marker trace (index 1) in each plot
            Plotly.restyle(plot1Div, updateData, [1]);
            Plotly.restyle(plot2Div, updateData, [1]);
        }

        // --- Event Listeners ---
        probabilitySlider.addEventListener('input', updateVisualization);
        consequenceSlider.addEventListener('input', updateVisualization);

        // Add click listeners to plots to update sliders
        plot1Div.on('plotly_click', (data) => {
             if (data.points.length > 0) {
                const point = data.points[0];
                // Find the closest grid point (or use direct click coords if preferred)
                const c = point.x;
                const p = point.y;

                // Update sliders (clamp values just in case)
                probabilitySlider.value = Math.max(0, Math.min(1, p));
                consequenceSlider.value = Math.max(0, Math.min(1, c));

                // Trigger update
                updateVisualization();
            }
        });
         plot2Div.on('plotly_click', (data) => {
             if (data.points.length > 0) {
                const point = data.points[0];
                const c = point.x;
                const p = point.y;
                probabilitySlider.value = Math.max(0, Math.min(1, p));
                consequenceSlider.value = Math.max(0, Math.min(1, c));
                updateVisualization();
            }
        });


        // --- Initial Calculation ---
        updateVisualization();

        // Optional: Handle window resize to ensure plots redraw correctly
        window.addEventListener('resize', () => {
             Plotly.Plots.resize(plot1Div);
             Plotly.Plots.resize(plot2Div);
        });

    </script>

</body>
</html>
